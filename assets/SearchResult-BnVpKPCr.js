import{f as X,u as Z,g as O,h as ee,P as se,t as le,i as te,j as M,k as Q,l,m as ae,n as U,p as re,R as P,q as oe,s as ue,v as ie,x as ne,y as ce,z as $,A as b,C as ve,B as de,D as he,E as pe,F as ye,G as me,H as ge,I as j,J as De,K as T}from"./app-BV5wVPFy.js";const fe=["/","/Doc/","/Doc/install.html","/Doc/log.html","/Doc/ToolsModule/AriScriptLauncher.html","/Doc/ToolsModule/CreaseSetEditor.html","/Doc/ToolsModule/ImportExport.html","/Doc/ToolsModule/LODTool.html","/Doc/ToolsModule/NormalEdit.html","/Doc/ToolsModule/QuickExport.html","/Doc/ToolsModule/QuickRename.html","/Doc/ToolsModule/RenameEdit.html","/Doc/ToolsModule/UVSetList.html","/Doc/ToolsModule/UnBevel.html","/Doc/ToolsModule/ViewCapture.html","/404.html","/Doc/ToolsModule/"],He="SEARCH_PRO_QUERY_HISTORY",m=j(He,[]),Re=()=>{const{queryHistoryCount:a}=T;return{enabled:a>0,queryHistory:m,addQueryHistory:u=>{m.value=Array.from(new Set([u,...m.value.slice(0,a-1)]))},removeQueryHistory:u=>{m.value=[...m.value.slice(0,u),...m.value.slice(u+1)]}}},E=a=>fe[a.id]+("anchor"in a?`#${a.anchor}`:""),ke="SEARCH_PRO_RESULT_HISTORY",{resultHistoryCount:I}=T,g=j(ke,[]),Qe=()=>({enabled:I>0,resultHistory:g,addResultHistory:r=>{{const u={link:E(r),display:r.display};"header"in r&&(u.header=r.header),g.value=[u,...g.value.slice(0,I-1)]}},removeResultHistory:r=>{g.value=[...g.value.slice(0,r),...g.value.slice(r+1)]}}),Te=a=>{const r=ve(),u=O(),w=de(),i=M(0),D=Q(()=>i.value>0),d=he([]);return pe(()=>{const{search:x,terminate:h}=ye(),f=me(y=>{const H=y.join(" "),{searchFilter:p=t=>t,splitWord:L,suggestionsFilter:o,...n}=r.value;H?(i.value+=1,x(y.join(" "),u.value,n).then(t=>p(t,H,u.value,w.value)).then(t=>{i.value-=1,d.value=t}).catch(t=>{console.warn(t),i.value-=1,i.value||(d.value=[])})):d.value=[]},T.searchDelay-T.suggestDelay);U([a,u],([y])=>f(y),{immediate:!0}),ge(()=>{h()})}),{isSearching:D,results:d}};var xe=X({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:r}){const u=Z(),w=O(),i=ee(se),{addQueryHistory:D,queryHistory:d,removeQueryHistory:x}=Re(),{resultHistory:h,addResultHistory:f,removeResultHistory:y}=Qe(),H=le(a,"queries"),{results:p,isSearching:L}=Te(H),o=te({isQuery:!0,index:0}),n=M(0),t=M(0),A=Q(()=>d.value.length>0||h.value.length>0),q=Q(()=>p.value.length>0),S=Q(()=>p.value[n.value]||null),_=()=>{const{isQuery:e,index:s}=o;s===0?(o.isQuery=!e,o.index=e?h.value.length-1:d.value.length-1):o.index=s-1},B=()=>{const{isQuery:e,index:s}=o;s===(e?d.value.length-1:h.value.length-1)?(o.isQuery=!e,o.index=0):o.index=s+1},V=()=>{n.value=n.value>0?n.value-1:p.value.length-1,t.value=S.value.contents.length-1},Y=()=>{n.value=n.value<p.value.length-1?n.value+1:0,t.value=0},z=()=>{t.value<S.value.contents.length-1?t.value+=1:Y()},G=()=>{t.value>0?t.value-=1:V()},C=e=>e.map(s=>De(s)?s:l(s[0],s[1])),J=e=>{if(e.type==="customField"){const s=ne[e.index]||"$content",[c,k=""]=ce(s)?s[w.value].split("$content"):s.split("$content");return e.display.map(v=>l("div",C([c,...v,k])))}return e.display.map(s=>l("div",C(s)))},R=()=>{n.value=0,t.value=0,r("updateQuery",""),r("close")},K=()=>l("ul",{class:"search-pro-result-list"},l("li",{class:"search-pro-result-list-item"},[l("div",{class:"search-pro-result-title"},i.value.queryHistory),d.value.map((e,s)=>l("div",{class:["search-pro-result-item",{active:o.isQuery&&o.index===s}],onClick:()=>{r("updateQuery",e)}},[l($,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},e),l("button",{class:"search-pro-remove-icon",innerHTML:b,onClick:c=>{c.preventDefault(),c.stopPropagation(),x(s)}})]))])),N=()=>l("ul",{class:"search-pro-result-list"},l("li",{class:"search-pro-result-list-item"},[l("div",{class:"search-pro-result-title"},i.value.resultHistory),h.value.map((e,s)=>l(P,{to:e.link,class:["search-pro-result-item",{active:!o.isQuery&&o.index===s}],onClick:()=>{R()}},()=>[l($,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},[e.header?l("div",{class:"content-header"},e.header):null,l("div",e.display.map(c=>C(c)).flat())]),l("button",{class:"search-pro-remove-icon",innerHTML:b,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(s)}})]))]));return ae("keydown",e=>{if(a.isFocusing){if(q.value){if(e.key==="ArrowUp")G();else if(e.key==="ArrowDown")z();else if(e.key==="Enter"){const s=S.value.contents[t.value];D(a.queries.join(" ")),f(s),u.push(E(s)),R()}}else if(e.key==="ArrowUp")_();else if(e.key==="ArrowDown")B();else if(e.key==="Enter"){const{index:s}=o;o.isQuery?(r("updateQuery",d.value[s]),e.preventDefault()):(u.push(h.value[s].link),R())}}}),U([n,t],()=>{var e;(e=document.querySelector(".search-pro-result-list-item.active .search-pro-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>l("div",{class:["search-pro-result-wrapper",{empty:a.queries.length?!q.value:!A.value}],id:"search-pro-results"},a.queries.length?L.value?l(re,{hint:i.value.searching}):q.value?l("ul",{class:"search-pro-result-list"},p.value.map(({title:e,contents:s},c)=>{const k=n.value===c;return l("li",{class:["search-pro-result-list-item",{active:k}]},[l("div",{class:"search-pro-result-title"},e||i.value.defaultTitle),s.map((v,W)=>{const F=k&&t.value===W;return l(P,{to:E(v),class:["search-pro-result-item",{active:F,"aria-selected":F}],onClick:()=>{D(a.queries.join(" ")),f(v),R()}},()=>[v.type==="text"?null:l(v.type==="title"?oe:v.type==="heading"?ue:ie,{class:"search-pro-result-type"}),l("div",{class:"search-pro-result-content"},[v.type==="text"&&v.header?l("div",{class:"content-header"},v.header):null,l("div",J(v))])])})])})):i.value.emptyResult:A.value?[K(),N()]:i.value.emptyHistory)}});export{xe as default};
